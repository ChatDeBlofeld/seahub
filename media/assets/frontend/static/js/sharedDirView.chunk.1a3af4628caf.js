(this["webpackJsonpseahub-frontend"]=this["webpackJsonpseahub-frontend"]||[]).push([[17],{147:function(e,t,i){"use strict";var a,n=i(6),o=i(7),s=i(9),r=i(8),l=i(2),c=i.n(l),d=i(4),h=i(1),u=i(10),p=i(5),m=i(16),b=i(0),f=function(e){Object(s.a)(i,e);var t=Object(r.a)(i);function i(e){var o;return Object(n.a)(this,i),(o=t.call(this,e)).queryZipProgress=function(){var e=o.state.zipToken;u.a.queryZipProgress(e).then((function(t){var i=t.data;1==i.failed?(clearInterval(a),o.setState({isLoading:!1,errorMsg:i.failed_reason})):(o.setState({zipProgress:0==i.total?"100%":(i.zipped/i.total*100).toFixed(2)+"%"}),i.total==i.zipped&&(clearInterval(a),o.props.toggleDialog(),location.href="".concat(h.ob,"zip/").concat(e)))})).catch((function(e){clearInterval(a);var t=p.a.getErrorMsg(e);o.setState({isLoading:!1,errorMsg:t})}))},o.cancelZipTask=function(){var e=o.state.zipToken;u.a.cancelZipTask(e).then((function(e){})).catch((function(e){}))},o.toggleDialog=function(){var e=o.state.zipProgress;e&&"100%"!=e&&(clearInterval(a),o.cancelZipTask()),o.props.toggleDialog()},o.state={isLoading:!0,errorMsg:"",zipProgress:null},o}return Object(o.a)(i,[{key:"componentDidMount",value:function(){var e=this,t=this.props,i=t.token,n=t.path,o=t.repoID,s=t.target;(i?s.length?u.a.getShareLinkDirentsZipTask(i,n,s):u.a.getShareLinkZipTask(i,n):u.a.zipDownload(o,n,s)).then((function(t){var i=t.data.zip_token;e.setState({isLoading:!1,errorMsg:"",zipToken:i}),e.queryZipProgress(),a=setInterval(e.queryZipProgress,1e3)})).catch((function(t){var i=p.a.getErrorMsg(t);e.setState({isLoading:!1,errorMsg:i})}))}},{key:"render",value:function(){return Object(b.jsxs)(d.x,{isOpen:!0,toggle:this.toggleDialog,children:[Object(b.jsx)(d.A,{toggle:this.toggleDialog,children:Object(h.qb)("Download")}),Object(b.jsx)(d.y,{children:Object(b.jsx)(g,{data:this.state})})]})}}]),i}(c.a.Component),g=function(e){Object(s.a)(i,e);var t=Object(r.a)(i);function i(){return Object(n.a)(this,i),t.apply(this,arguments)}return Object(o.a)(i,[{key:"render",value:function(){var e=this.props.data,t=e.isLoading,i=e.errorMsg,a=e.zipProgress;return t?Object(b.jsx)(m.a,{}):i?Object(b.jsx)("p",{className:"error mt-4 text-center",children:i}):Object(b.jsx)("p",{className:"mt-4 text-center",children:"".concat(Object(h.qb)("Packaging...")," ").concat(a)})}}]),i}(c.a.Component);t.a=f},1514:function(e,t,i){i(54),e.exports=i(1698)},1515:function(e,t,i){},1698:function(e,t,i){"use strict";i.r(t);var a=i(6),n=i(7),o=i(27),s=i(9),r=i(8),l=i(2),c=i.n(l),d=i(24),h=i.n(d),u=i(4),p=i(13),m=i.n(p),b=i(67),f=i(1),g=i(5),v=i(10),j=i(16),O=i(11),x=i(20),S=i(147),y=i(170),k=i(71),w=i(253),C=i.n(w),I=i(156),M=i.n(I),_=i(0),P="uploading",D="error",F="isSaving",N="uploaded",L=function(e){Object(s.a)(i,e);var t=Object(r.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).onUploadCancel=function(e){e.preventDefault(),n.props.onUploadCancel(n.props.resumableFile)},n.onUploadRetry=function(e){e.preventDefault(),n.props.onUploadRetry(n.props.resumableFile)},n.formatFileSize=function(e){return"number"!==typeof e?"":e>=1e9?(e/1e9).toFixed(1)+" G":e>=1e6?(e/1e6).toFixed(1)+" M":e>=1e3?(e/1e3).toFixed(1)+" K":e.toFixed(1)+" B"},n.state={uploadState:P},n}return Object(n.a)(i,[{key:"componentWillReceiveProps",value:function(e){var t=e.resumableFile,i=P;t.error?i=D:(0!==t.remainingTime||t.isSaved||(i=F),t.isSaved&&(i=N)),this.setState({uploadState:i})}},{key:"render",value:function(){var e=this.props.resumableFile,t=Math.round(100*e.progress()),i=e.error,a=e.newFileName,n=this.formatFileSize(e.size);return Object(_.jsxs)("tr",{className:"file-upload-item",children:[Object(_.jsx)("td",{className:"upload-name",children:Object(_.jsx)("div",{className:"ellipsis",title:a,children:a})}),Object(_.jsx)("td",{className:"ellipsis",children:Object(_.jsx)("span",{className:"file-size",title:n,children:n})}),Object(_.jsxs)("td",{className:"upload-progress ellipsis",children:[(this.state.uploadState===P||this.state.uploadState===F)&&Object(_.jsxs)(l.Fragment,{children:[e.size>=1e8&&Object(_.jsxs)(l.Fragment,{children:[e.isUploading()&&Object(_.jsxs)("div",{className:"progress-container",children:[Object(_.jsx)("div",{className:"progress",children:Object(_.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(t,"%")},"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":"100"})}),-1===e.remainingTime&&Object(_.jsx)("div",{className:"progress-text",children:Object(f.qb)("Preparing to upload...")}),e.remainingTime>0&&Object(_.jsxs)("div",{className:"progress-text",children:[Object(f.qb)("Remaining")," ",g.a.formatTime(e.remainingTime)]}),0===e.remainingTime&&Object(_.jsx)("div",{className:"progress-text",children:Object(f.qb)("Indexing...")})]}),!e.isUploading()&&Object(_.jsx)("div",{className:"progress-container d-flex align-items-center",children:Object(_.jsx)("div",{className:"progress",children:Object(_.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(t,"%")},"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":"100"})})})]}),e.size<1e8&&Object(_.jsx)("div",{className:"progress-container d-flex align-items-center",children:Object(_.jsx)("div",{className:"progress",children:Object(_.jsx)("div",{className:"progress-bar",role:"progressbar",style:{width:"".concat(t,"%")},"aria-valuenow":t,"aria-valuemin":"0","aria-valuemax":"100"})})})]}),this.state.uploadState===D&&Object(_.jsx)("div",{className:"message err-message ml-0",dangerouslySetInnerHTML:{__html:i}})]}),Object(_.jsx)("td",{className:"upload-operation ellipsis",children:Object(_.jsxs)(l.Fragment,{children:[this.state.uploadState===P&&Object(_.jsx)("a",{href:"#",onClick:this.onUploadCancel,children:Object(f.qb)("Cancel")}),this.state.uploadState===D&&Object(_.jsx)("a",{href:"#",onClick:this.onUploadRetry,children:Object(f.qb)("Retry")}),this.state.uploadState===F&&Object(_.jsx)("span",{className:"saving",children:Object(f.qb)("Saving...")}),this.state.uploadState===N&&Object(_.jsx)("span",{className:"uploaded",children:Object(f.qb)("Uploaded")})]})})]})}}]),i}(c.a.Component),E=function(e){Object(s.a)(i,e);var t=Object(r.a)(i);function i(){return Object(a.a)(this,i),t.apply(this,arguments)}return Object(n.a)(i,[{key:"render",value:function(){var e=this.props.file,t=Object(f.qb)("Please upload files less than {placeholder}M").replace("{placeholder}",f.Nb);return Object(_.jsxs)("tr",{className:"file-upload-item",children:[Object(_.jsx)("td",{className:"upload-name",children:Object(_.jsx)("div",{className:"ellipsis",title:e.name,children:e.name})}),Object(_.jsx)("td",{colSpan:3,className:"error",children:t})]})}}]),i}(c.a.Component),U=function(e){Object(s.a)(i,e);var t=Object(r.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).onCancelAllUploading=function(){n.props.onCancelAllUploading()},n.onMinimizeUpload=function(e){e.nativeEvent.stopImmediatePropagation(),n.setState({isMinimized:!n.state.isMinimized})},n.onCloseUpload=function(e){e.nativeEvent.stopImmediatePropagation(),n.props.onCloseUploadDialog()},n.state={isMinimized:!1},n}return Object(n.a)(i,[{key:"render",value:function(){var e=this,t=g.a.formatBitRate(this.props.uploadBitrate),i=Object(f.qb)("File Upload"),a=Object(f.qb)("File Uploading...")+" "+this.props.totalProgress+"% ("+t+")",n=Object(_.jsx)("span",{className:"sf2-icon-minus",onClick:this.onMinimizeUpload}),o=Object(_.jsxs)(l.Fragment,{children:[Object(_.jsx)("span",{className:"sf2-icon-minus",onClick:this.onMinimizeUpload}),Object(_.jsx)("span",{className:"sf2-icon-x1",onClick:this.onCloseUpload})]}),s=this.props,r=s.totalProgress,c=s.allFilesUploaded,d=s.retryFileList;return Object(_.jsxs)("div",{className:"uploader-list-view mw-100",style:{height:this.state.isMinimized?"2.25rem":"20rem"},children:[Object(_.jsxs)("div",{className:"uploader-list-header",children:[Object(_.jsx)("div",{className:"title",children:100===r?i:a}),Object(_.jsx)("div",{className:"uploader-options",children:100===r||c?o:n})]}),Object(_.jsxs)("div",{className:"uploader-list-content",children:[Object(_.jsxs)("div",{className:"text-right mt-2",children:[d.length>0?Object(_.jsx)("span",{className:"cursor-pointer",onClick:this.props.onUploadRetryAll,children:Object(f.qb)("Retry All")}):Object(_.jsx)("span",{className:"cursor-pointer disabled-link",children:Object(f.qb)("Retry All")}),c?Object(_.jsx)("span",{className:"cursor-pointer ml-3 disabled-link",children:Object(f.qb)("Cancel All")}):Object(_.jsx)("span",{className:"cursor-pointer ml-3",onClick:this.onCancelAllUploading,children:Object(f.qb)("Cancel All")})]}),Object(_.jsxs)("table",{className:"table-thead-hidden",children:[Object(_.jsx)("thead",{children:Object(_.jsxs)("tr",{children:[Object(_.jsx)("th",{width:"30%",children:Object(f.qb)("name")}),Object(_.jsx)("th",{width:"20%",children:Object(f.qb)("size")}),Object(_.jsx)("th",{width:"30%",children:Object(f.qb)("progress")}),Object(_.jsx)("th",{width:"20%",children:Object(f.qb)("state")})]})}),Object(_.jsxs)("tbody",{children:[this.props.forbidUploadFileList.map((function(e,t){return Object(_.jsx)(E,{file:e},t)})),this.props.uploadFileList.map((function(t,i){return Object(_.jsx)(L,{resumableFile:t,onUploadCancel:e.props.onUploadCancel,onUploadRetry:e.props.onUploadRetry},i)}))]})]})]})]})}}]),i}(c.a.Component),T=(i(503),function(e){Object(s.a)(i,e);var t=Object(r.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).componentWillUnmount=function(){window.onbeforeunload=null,!0===n.props.dragAndDrop&&n.resumable.disableDropOnDocument()},n.onbeforeunload=function(){if(window.uploader&&window.uploader.isUploadProgressDialogShow&&100!==window.uploader.totalProgress)return""},n.bindCallbackHandler=function(){var e=n.props,t=e.minFileSizeErrorCallback,i=e.fileTypeErrorCallback;n.maxFilesErrorCallback&&(n.resumable.opts.maxFilesErrorCallback=n.maxFilesErrorCallback),t&&(n.resumable.opts.minFileSizeErrorCallback=n.props.minFileSizeErrorCallback),n.maxFileSizeErrorCallback&&(n.resumable.opts.maxFileSizeErrorCallback=n.maxFileSizeErrorCallback),i&&(n.resumable.opts.fileTypeErrorCallback=n.props.fileTypeErrorCallback)},n.bindEventHandler=function(){n.resumable.on("chunkingComplete",n.onChunkingComplete.bind(Object(o.a)(n))),n.resumable.on("fileAdded",n.onFileAdded.bind(Object(o.a)(n))),n.resumable.on("filesAddedComplete",n.filesAddedComplete.bind(Object(o.a)(n))),n.resumable.on("fileProgress",n.onFileProgress.bind(Object(o.a)(n))),n.resumable.on("fileSuccess",n.onFileUploadSuccess.bind(Object(o.a)(n))),n.resumable.on("progress",n.onProgress.bind(Object(o.a)(n))),n.resumable.on("complete",n.onComplete.bind(Object(o.a)(n))),n.resumable.on("pause",n.onPause.bind(Object(o.a)(n))),n.resumable.on("fileRetry",n.onFileRetry.bind(Object(o.a)(n))),n.resumable.on("fileError",n.onFileError.bind(Object(o.a)(n))),n.resumable.on("error",n.onError.bind(Object(o.a)(n))),n.resumable.on("beforeCancel",n.onBeforeCancel.bind(Object(o.a)(n))),n.resumable.on("cancel",n.onCancel.bind(Object(o.a)(n))),n.resumable.on("dragstart",n.onDragStart.bind(Object(o.a)(n)))},n.maxFilesErrorCallback=function(e,t){var i=f.Mb,a=Object(f.qb)("Please upload no more than {maxFiles} files at a time.");a=a.replace("{maxFiles}",i),O.a.danger(a)},n.maxFileSizeErrorCallback=function(e){var t=n.state.forbidUploadFileList;t.push(e),n.setState({forbidUploadFileList:t})},n.onChunkingComplete=function(e){!0===n.state.allFilesUploaded&&n.setState({allFilesUploaded:!1});var t="/"===n.props.path?"/":n.props.path+"/",i=e.fileName,a=e.relativePath,o=i===a;if(e.formData={},o)e.formData={parent_dir:t};else{var s=a.slice(0,a.lastIndexOf("/")+1);e.formData={parent_dir:t,relative_path:s}}},n.onFileAdded=function(e,t){if(e.fileName===e.relativePath&&1===t.length){n.setUploadFileList(n.resumable.files);var i=n.props,a=i.token,o=i.relativePath;v.a.sharedLinkGetFileUploadUrl(a,o).then((function(t){n.resumable.opts.target=t.data.upload_link+"?ret-json=1",n.resumableUpload(e)})).catch((function(e){var t=g.a.getErrorMsg(e);O.a.danger(t)}))}else if(n.setUploadFileList(n.resumable.files),!n.isUploadLinkLoaded){n.isUploadLinkLoaded=!0;var s=n.props,r=s.token,l=s.relativePath;v.a.sharedLinkGetFileUploadUrl(r,l).then((function(e){n.resumable.opts.target=e.data.upload_link+"?ret-json=1",n.resumable.upload()})).catch((function(e){var t=g.a.getErrorMsg(e);O.a.danger(t)}))}},n.resumableUpload=function(e){var t=n.props,i=t.repoID,a=t.path;v.a.getFileUploadedBytes(i,a,e.fileName).then((function(t){var i=t.data.uploadedBytes,a=1024*parseInt(f.cc)*1024||1048576,o=Math.floor(i/a);e.markChunksCompleted(o),n.resumable.upload()})).catch((function(e){var t=g.a.getErrorMsg(e);O.a.danger(t)}))},n.filesAddedComplete=function(e,t){n.state.forbidUploadFileList.length>0&&0===t.length&&n.setState({isUploadProgressDialogShow:!0,totalProgress:100})},n.setUploadFileList=function(){var e=n.resumable.files;n.setState({uploadFileList:e,isUploadProgressDialogShow:!0}),g.a.registerGlobalVariable("uploader","isUploadProgressDialogShow",!0)},n.onFileProgress=function(e){var t=n.getBitrate(),i=n.state.uploadFileList.map((function(i){if(i.uniqueIdentifier===e.uniqueIdentifier&&t){var a=8*(i.size-i.size*i.progress()),n=Math.floor(a/t);i.remainingTime=n}return i}));n.setState({uploadBitrate:t,uploadFileList:i})},n.getBitrate=function(){var e=0,t=0,i=(new Date).getTime();if(n.resumable.files.forEach((function(t){e+=t.progress()*t.size})),n.timestamp){var a=i-n.timestamp;if(a<n.bitrateInterval)return n.state.uploadBitrate;(e<n.loaded||0===n.loaded)&&(n.loaded=e),t=(e-n.loaded)*(1e3/a)*8}return n.timestamp=i,n.loaded=e,t},n.onProgress=function(){var e=Math.round(100*n.resumable.progress());n.setState({totalProgress:e}),g.a.registerGlobalVariable("uploader","totalProgress",e)},n.onFileUploadSuccess=function(e,t){var i=e.formData,a=(new Date).getTime()/1e3;t=i.replace?t:JSON.parse(t)[0],i.relative_path;var o={id:t.id,type:"file",name:t.name,size:t.size,mtime:a};n.props.onFileUploadSuccess(o);var s=n.state.uploadFileList.map((function(i){return i.uniqueIdentifier===e.uniqueIdentifier&&(i.newFileName=t.name,i.isSaved=!0),i}));n.setState({uploadFileList:s})},n.onFileError=function(e,t){var i="";if(t){var a=t.replace(/\n/g,"");a=JSON.parse(a),"File locked by others."===(i=a.error)&&(i=Object(f.qb)("File is locked by others.")),"Internal error."===i&&(i=Object(f.qb)("Internal Server Error"))}else i=Object(f.qb)("Network error");var o=n.state.uploadFileList.map((function(t){return t.uniqueIdentifier===e.uniqueIdentifier&&(n.state.retryFileList.push(t),t.error=i),t}));n.loaded=0,n.setState({retryFileList:n.state.retryFileList,uploadFileList:o})},n.onComplete=function(){n.notifiedFolders=[],n.isUploadLinkLoaded=!1,n.setState({allFilesUploaded:!0})},n.onPause=function(){},n.onError=function(e){n.isUploadLinkLoaded=!1,g.a.registerGlobalVariable("uploader","totalProgress",100)},n.onFileRetry=function(){},n.onBeforeCancel=function(){},n.onCancel=function(){},n.setHeaders=function(e,t){var i=t.offset,a=t.getOpt("chunkSize"),n=0===e.size?1:e.size,o=0!==i?i*a:0,s=Math.min(n,(i+1)*a)-1;return n-t.endByte<a&&!t.getOpt("forceChunkSize")&&(s=n),{Accept:"application/json; text/javascript, */*; q=0.01","Content-Disposition":'attachment; filename="'+encodeURI(e.fileName)+'"',"Content-Range":"bytes "+o+"-"+s+"/"+n}},n.setQuery=function(e){return e.formData},n.generateUniqueIdentifier=function(e){var t=e.webkitRelativePath||e.relativePath||e.fileName||e.name;return M()(t+new Date)+t},n.onClick=function(e){e.nativeEvent.stopImmediatePropagation(),e.stopPropagation()},n.onFileUpload=function(){n.uploadInput.current.removeAttribute("webkitdirectory"),n.uploadInput.current.click()},n.onFolderUpload=function(){n.uploadInput.current.setAttribute("webkitdirectory","webkitdirectory"),n.uploadInput.current.click()},n.onDragStart=function(){n.uploadInput.current.setAttribute("webkitdirectory","webkitdirectory")},n.onCloseUploadDialog=function(){n.loaded=0,n.resumable.files=[],n.isUploadLinkLoaded=!1,n.setState({isUploadProgressDialogShow:!1,uploadFileList:[],forbidUploadFileList:[]}),g.a.registerGlobalVariable("uploader","isUploadProgressDialogShow",!1)},n.onUploadCancel=function(e){var t=n.state.uploadFileList.filter((function(t){return t.uniqueIdentifier!==e.uniqueIdentifier||(t.cancel(),!1)}));n.resumable.isUploading()||(n.setState({totalProgress:"100",allFilesUploaded:!0}),n.loaded=0),n.setState({uploadFileList:t})},n.onCancelAllUploading=function(){var e=n.state.uploadFileList.filter((function(e){return!Math.round(1!==e.progress())||(e.cancel(),!1)}));n.loaded=0,n.setState({allFilesUploaded:!0,totalProgress:"100",uploadFileList:e}),n.isUploadLinkLoaded=!1},n.onUploadRetry=function(e){var t=n.props,i=t.token,a=t.relativePath;v.a.sharedLinkGetFileUploadUrl(i,a).then((function(t){n.resumable.opts.target=t.data.upload_link+"?ret-json=1";var i=n.state.retryFileList.filter((function(t){return t.uniqueIdentifier!==e.uniqueIdentifier})),a=n.state.uploadFileList.map((function(t){return t.uniqueIdentifier===e.uniqueIdentifier&&(t.error=null,n.retryUploadFile(t)),t}));n.setState({retryFileList:i,uploadFileList:a})})).catch((function(e){var t=g.a.getErrorMsg(e);O.a.danger(t)}))},n.onUploadRetryAll=function(){var e=n.props,t=e.token,i=e.relativePath;v.a.sharedLinkGetFileUploadUrl(t,i).then((function(e){n.resumable.opts.target=e.data.upload_link+"?ret-json=1",n.state.retryFileList.forEach((function(e){e.error=!1,n.retryUploadFile(e)}));var t=n.state.uploadFileList.slice(0);n.setState({retryFileList:[],uploadFileList:t})})).catch((function(e){var t=g.a.getErrorMsg(e);O.a.danger(t)}))},n.retryUploadFile=function(e){var t=n.props,i=t.repoID,a=t.path,o=e.fileName;if(!(e.fileName===e.relativePath)){var s=e.formData.relative_path;o=("/"===a?a+s:a+"/"+s)+o}e.bootstrap();var r=!1;e.resumableObj.on("chunkingComplete",(function(){r||v.a.getFileUploadedBytes(i,a,o).then((function(t){var i=t.data.uploadedBytes,a=1024*parseInt(f.cc)*1024||1048576,n=Math.floor(i/a);e.markChunksCompleted(n),e.resumableObj.upload()})).catch((function(e){var t=g.a.getErrorMsg(e);O.a.danger(t)})),r=!0}))},n.uploadFile=function(){var e=n.resumable.files[n.resumable.files.length-1],t=n.props,i=t.token,a=t.relativePath;v.a.sharedLinkGetFileUploadUrl(i,a).then((function(t){n.resumable.opts.target=t.data.upload_link+"?ret-json=1",n.setState({isUploadRemindDialogShow:!1,isUploadProgressDialogShow:!0,uploadFileList:[].concat(Object(k.a)(n.state.uploadFileList),[e])},(function(){n.resumable.upload()})),g.a.registerGlobalVariable("uploader","isUploadProgressDialogShow",!0)})).catch((function(e){var t=g.a.getErrorMsg(e);O.a.danger(t)}))},n.cancelFileUpload=function(){n.resumable.files.pop(),n.setState({isUploadRemindDialogShow:!1})},n.state={retryFileList:[],uploadFileList:[],forbidUploadFileList:[],totalProgress:0,isUploadProgressDialogShow:!1,isUploadRemindDialogShow:!1,currentResumableFile:null,uploadBitrate:0,allFilesUploaded:!1},n.uploadInput=c.a.createRef(),n.notifiedFolders=[],n.timestamp=null,n.loaded=0,n.bitrateInterval=500,window.onbeforeunload=n.onbeforeunload,n.isUploadLinkLoaded=!1,n}return Object(n.a)(i,[{key:"componentDidMount",value:function(){this.resumable=new C.a({target:"",query:this.setQuery||{},fileType:this.props.filetypes,maxFiles:f.Mb||void 0,maxFileSize:1e3*f.Nb*1e3||void 0,testMethod:this.props.testMethod||"post",testChunks:this.props.testChunks||!1,headers:this.setHeaders||{},withCredentials:this.props.withCredentials||!1,chunkSize:1024*parseInt(f.cc)*1024||1048576,simultaneousUploads:this.props.simultaneousUploads||1,fileParameterName:this.props.fileParameterName,generateUniqueIdentifier:this.generateUniqueIdentifier,forceChunkSize:!0,maxChunkRetries:3,minFileSize:0}),this.resumable.assignBrowse(this.uploadInput.current,!0),!0===this.props.dragAndDrop&&this.resumable.enableDropOnDocument(),this.bindCallbackHandler(),this.bindEventHandler()}},{key:"render",value:function(){return Object(_.jsxs)(l.Fragment,{children:[Object(_.jsx)("div",{className:"file-uploader-container",children:Object(_.jsx)("div",{className:"file-uploader",children:Object(_.jsx)("input",{className:"upload-input",type:"file",ref:this.uploadInput,onClick:this.onClick})})}),this.state.isUploadProgressDialogShow&&Object(_.jsx)(U,{retryFileList:this.state.retryFileList,uploadFileList:this.state.uploadFileList,forbidUploadFileList:this.state.forbidUploadFileList,totalProgress:this.state.totalProgress,uploadBitrate:this.state.uploadBitrate,allFilesUploaded:this.state.allFilesUploaded,onCloseUploadDialog:this.onCloseUploadDialog,onCancelAllUploading:this.onCancelAllUploading,onUploadCancel:this.onUploadCancel,onUploadRetry:this.onUploadRetry,onUploadRetryAll:this.onUploadRetryAll})]})}}]),i}(c.a.Component)),z=i(89),q=function(e){Object(s.a)(i,e);var t=Object(r.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).onSaveSharedFile=function(){var e=n.props,t=e.sharedToken,i=e.parentDir,a=e.items;v.a.saveSharedDir(n.state.repo.repo_id,n.state.selectedPath,t,i,a).then((function(e){n.props.toggleCancel(),n.props.handleSaveSharedDir()})).catch((function(e){var t=g.a.getErrorMsg(e);n.setState({errMessage:t})}))},n.onDirentItemClick=function(e,t,i){"dir"===i.type?n.setState({repo:e,selectedPath:t}):n.setState({repo:null,selectedPath:""})},n.onRepoItemClick=function(e){n.setState({repo:e,selectedPath:"/"})},n.state={repo:null,selectedPath:"",errMessage:""},n}return Object(n.a)(i,[{key:"render",value:function(){return Object(_.jsxs)(u.x,{isOpen:!0,className:"sf-save-file",children:[Object(_.jsx)(u.A,{toggle:this.props.toggleCancel,children:Object(f.qb)("Save to:")}),Object(_.jsxs)(u.y,{children:[Object(_.jsx)(z.a,{isShowFile:!1,onDirentItemClick:this.onDirentItemClick,onRepoItemClick:this.onRepoItemClick,mode:"only_all_repos"}),this.state.errMessage&&Object(_.jsx)(u.a,{color:"danger",children:this.state.errMessage})]}),Object(_.jsxs)(u.z,{children:[Object(_.jsx)(u.c,{color:"secondary",onClick:this.props.toggleCancel,children:Object(f.qb)("Cancel")}),this.state.selectedPath?Object(_.jsx)(u.c,{color:"primary",onClick:this.onSaveSharedFile,children:Object(f.qb)("Submit")}):Object(_.jsx)(u.c,{color:"primary",disabled:!0,children:Object(f.qb)("Submit")})]})]})}}]),i}(c.a.Component);i(1515),i(502);m.a.locale(window.app.config.lang);var A=window.app.pageOptions.name,R=window.shared.pageOptions,B=R.token,Y=R.dirName,X=R.dirPath,Z=R.sharedBy,W=R.repoID,K=R.relativePath,H=R.mode,G=R.thumbnailSize,V=R.zipped,J=R.trafficOverLimit,Q=R.canDownload,$=R.noQuota,ee=R.canUpload,te=R.enableVideoThumbnail,ie=!J&&Q,ae=function(e){Object(s.a)(i,e);var t=Object(r.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).sortItems=function(e,t){n.setState({sortBy:e,sortOrder:t,items:g.a.sortDirentsInSharedDir(n.state.items,e,t)})},n.getThumbnails=function(){var e=n.state.items.filter((function(e){return!e.is_dir&&(g.a.imageCheck(e.file_name)||te&&g.a.videoCheck(e.file_name))&&!e.encoded_thumbnail_src}));if(0!=e.length){var t=e.length,i=Object(o.a)(n);!function a(n){var o=e[n];v.a.getShareLinkThumbnail(B,o.file_path,G).then((function(e){o.encoded_thumbnail_src=e.data.encoded_thumbnail_src})).catch((function(e){})).then((function(){n<t-1?a(++n):i.setState({items:i.state.items})}))}(0)}},n.renderPath=function(){return Object(_.jsxs)(c.a.Fragment,{children:[V.map((function(e,t){if(t!=V.length-1)return Object(_.jsxs)(c.a.Fragment,{children:[Object(_.jsx)("a",{href:"?p=".concat(encodeURIComponent(e.path),"&mode=").concat(H),className:"mx-1 ellipsis",title:e.name,children:e.name}),Object(_.jsx)("span",{children:" / "})]},t)})),Object(_.jsx)("span",{className:"ml-1 ellipsis",title:V[V.length-1].name,children:V[V.length-1].name})]})},n.zipDownloadFolder=function(e){f.Ac?v.a.getShareLinkZipTask(B,e).then((function(e){var t=e.data.zip_token;location.href="".concat(f.ob,"zip/").concat(t)})).catch((function(e){var t=g.a.getErrorMsg(e);n.setState({isLoading:!1,errorMsg:t})})):n.setState({isZipDialogOpen:!0,zipFolderPath:e})},n.zipDownloadSelectedItems=function(){if(f.Ac){var e=n.state.items.filter((function(e){return e.isSelected})).map((function(e){return e.file_name||e.folder_name}));v.a.getShareLinkDirentsZipTask(B,K,e).then((function(e){var t=e.data.zip_token;location.href="".concat(f.ob,"zip/").concat(t)})).catch((function(e){var t=g.a.getErrorMsg(e);n.setState({isLoading:!1,errorMsg:t})}))}else n.setState({isZipDialogOpen:!0,zipFolderPath:K,selectedItems:n.state.items.filter((function(e){return e.isSelected})).map((function(e){return e.file_name||e.folder_name}))})},n.saveSelectedItems=function(){n.setState({isSaveSharedDirDialogShow:!0,itemsForSave:n.state.items.filter((function(e){return e.isSelected})).map((function(e){return e.file_name||e.folder_name}))})},n.saveAllItems=function(){n.setState({isSaveSharedDirDialogShow:!0,itemsForSave:n.state.items.map((function(e){return e.file_name||e.folder_name}))})},n.toggleSaveSharedDirCancel=function(){n.setState({isSaveSharedDirDialogShow:!1,itemsForSave:[]})},n.handleSaveSharedDir=function(){O.a.success(Object(f.qb)("Successfully saved"),{duration:3})},n.closeZipDialog=function(){n.setState({isZipDialogOpen:!1,zipFolderPath:"",selectedItems:[]})},n.prepareImageItem=function(e){var t=e.file_name,i="gif"==t.substr(t.lastIndexOf(".")+1).toLowerCase(),a="".concat(f.qc,"d/").concat(B,"/files/?p=").concat(encodeURIComponent(e.file_path));return{name:t,url:a,src:i?"".concat(a,"&raw=1"):"".concat(f.qc,"thumbnail/").concat(B,"/").concat(f.vc).concat(g.a.encodePath(e.file_path))}},n.showImagePopup=function(e){var t=n.state.items.filter((function(e){return!e.is_dir&&g.a.imageCheck(e.file_name)})),i=t.map((function(e){return n.prepareImageItem(e)}));n.setState({isImagePopupOpen:!0,imageItems:i,imageIndex:t.indexOf(e)})},n.closeImagePopup=function(){n.setState({isImagePopupOpen:!1})},n.moveToPrevImage=function(){var e=n.state.imageItems.length;n.setState((function(t){return{imageIndex:(t.imageIndex+e-1)%e}}))},n.moveToNextImage=function(){var e=n.state.imageItems.length;n.setState((function(t){return{imageIndex:(t.imageIndex+1)%e}}))},n.toggleAllSelected=function(){n.setState((function(e){return{isAllItemsSelected:!e.isAllItemsSelected,items:n.state.items.map((function(t){return t.isSelected=!e.isAllItemsSelected,t}))}}))},n.toggleItemSelected=function(e,t){n.setState({items:n.state.items.map((function(i){return i===e&&(i.isSelected=t),i}))},(function(){n.setState({isAllItemsSelected:!n.state.items.some((function(e){return!e.isSelected}))})}))},n.onUploadFile=function(e){e.nativeEvent.stopImmediatePropagation(),n.uploader.onFileUpload()},n.onFileUploadSuccess=function(e){var t=e.name,i=e.size,a={isSelected:!1,file_name:t,file_path:g.a.joinPath(K,t),is_dir:!1,last_modified:m()().format(),size:i},o=n.state.items.filter((function(e){return e.is_dir})),s=Array.from(n.state.items);s.splice(o.length,0,a),n.setState({items:s}),v.a.shareLinksUploadDone(B,g.a.joinPath(X,t))},n.state={isLoading:!0,errorMsg:"",items:[],isAllItemsSelected:!1,selectedItems:[],sortBy:"name",sortOrder:"asc",isZipDialogOpen:!1,zipFolderPath:"",isSaveSharedDirDialogShow:!1,itemsForSave:[],isImagePopupOpen:!1,imageItems:[],imageIndex:0},n}return Object(n.a)(i,[{key:"componentDidMount",value:function(){var e=this;J&&O.a.danger(Object(f.qb)("File download is disabled: the share link traffic of owner is used up."),{duration:3}),v.a.listSharedDir(B,K,G).then((function(t){var i=t.data.dirent_list.map((function(e){return e.isSelected=!1,e}));e.setState({isLoading:!1,errorMsg:"",items:g.a.sortDirentsInSharedDir(i,e.state.sortBy,e.state.sortOrder)}),e.getThumbnails()})).catch((function(t){var i=g.a.getErrorMsg(t);e.setState({isLoading:!1,errorMsg:i})}))}},{key:"render",value:function(){var e=this,t=g.a.isDesktop(),i="btn btn-secondary btn-icon sf-view-mode-btn";return Object(_.jsxs)(c.a.Fragment,{children:[Object(_.jsxs)("div",{className:"h-100 d-flex flex-column",children:[Object(_.jsxs)("div",{className:"top-header d-flex justify-content-between",children:[Object(_.jsx)("a",{href:f.qc,children:Object(_.jsx)("img",{src:f.Ob+f.Jb,height:f.Ib,width:f.Kb,title:f.rc,alt:"logo"})}),A&&Object(_.jsx)(b.a,{})]}),Object(_.jsx)("div",{className:"o-auto",children:Object(_.jsxs)("div",{className:"shared-dir-view-main",children:[Object(_.jsx)("h2",{className:"h3",children:Y}),Object(_.jsxs)("p",{children:[Object(f.qb)("Shared by: "),Z]}),Object(_.jsxs)("div",{className:"d-flex justify-content-between align-items-center op-bar",children:[Object(_.jsxs)("p",{className:"m-0 mr-4 ellipsis d-flex align-items-center",children:[Object(_.jsx)("span",{className:"flex-none",children:Object(f.qb)("Current path: ")}),this.renderPath()]}),Object(_.jsxs)("div",{className:"flex-none",children:[t&&Object(_.jsxs)("div",{className:"view-mode btn-group",children:[Object(_.jsx)("a",{href:"?p=".concat(encodeURIComponent(K),"&mode=list"),className:"".concat(i," sf2-icon-list-view ").concat("list"==H?"current-mode":""),title:Object(f.qb)("List"),"aria-label":Object(f.qb)("List")}),Object(_.jsx)("a",{href:"?p=".concat(encodeURIComponent(K),"&mode=grid"),className:"".concat(i," sf2-icon-grid-view ").concat("grid"==H?"current-mode":""),title:Object(f.qb)("Grid"),"aria-label":Object(f.qb)("Grid")})]}),ee&&Object(_.jsx)(u.c,{disabled:$,title:$?Object(f.qb)("The owner of this library has run out of space."):"",onClick:this.onUploadFile,className:"ml-2 shared-dir-op-btn shared-dir-upload-btn",children:Object(f.qb)("Upload")}),ie&&Object(_.jsx)(l.Fragment,{children:this.state.items.some((function(e){return e.isSelected}))?Object(_.jsxs)(l.Fragment,{children:[Object(_.jsx)(u.c,{color:"success",onClick:this.zipDownloadSelectedItems,className:"ml-2 shared-dir-op-btn",children:Object(f.qb)("ZIP Selected Items")}),Q&&A&&A!==Z&&Object(_.jsx)(u.c,{color:"success",onClick:this.saveSelectedItems,className:"ml-2 shared-dir-op-btn",children:Object(f.qb)("Save Selected Items")})]}):Object(_.jsxs)(l.Fragment,{children:[Object(_.jsx)(u.c,{color:"success",onClick:this.zipDownloadFolder.bind(this,K),className:"ml-2 shared-dir-op-btn",children:Object(f.qb)("ZIP")}),Q&&A&&A!==Z&&Object(_.jsx)(u.c,{color:"success",onClick:this.saveAllItems,className:"ml-2 shared-dir-op-btn",children:Object(f.qb)("Save")})]})})]})]}),!$&&ee&&Object(_.jsx)(T,{ref:function(t){return e.uploader=t},dragAndDrop:!1,token:B,path:"/"===X?X:X.replace(/\/+$/,""),relativePath:"/"===K?K:K.replace(/\/+$/,""),repoID:W,onFileUploadSuccess:this.onFileUploadSuccess}),Object(_.jsx)(ne,{isDesktop:t,isLoading:this.state.isLoading,errorMsg:this.state.errorMsg,items:this.state.items,sortBy:this.state.sortBy,sortOrder:this.state.sortOrder,sortItems:this.sortItems,isAllItemsSelected:this.state.isAllItemsSelected,toggleAllSelected:this.toggleAllSelected,toggleItemSelected:this.toggleItemSelected,zipDownloadFolder:this.zipDownloadFolder,showImagePopup:this.showImagePopup})]})})]}),this.state.isZipDialogOpen&&Object(_.jsx)(x.a,{children:Object(_.jsx)(S.a,{token:B,path:this.state.zipFolderPath,target:this.state.selectedItems,toggleDialog:this.closeZipDialog})}),this.state.isSaveSharedDirDialogShow&&Object(_.jsx)(q,{sharedToken:B,parentDir:K,items:this.state.itemsForSave,toggleCancel:this.toggleSaveSharedDirCancel,handleSaveSharedDir:this.handleSaveSharedDir}),this.state.isImagePopupOpen&&Object(_.jsx)(x.a,{children:Object(_.jsx)(y.a,{imageItems:this.state.imageItems,imageIndex:this.state.imageIndex,closeImagePopup:this.closeImagePopup,moveToPrevImage:this.moveToPrevImage,moveToNextImage:this.moveToNextImage})})]})}}]),i}(c.a.Component),ne=function(e){Object(s.a)(i,e);var t=Object(r.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).sortByName=function(e){e.preventDefault();var t="asc"==n.props.sortOrder?"desc":"asc";n.props.sortItems("name",t)},n.sortByTime=function(e){e.preventDefault();var t="asc"==n.props.sortOrder?"desc":"asc";n.props.sortItems("time",t)},n.sortBySize=function(e){e.preventDefault();var t="asc"==n.props.sortOrder?"desc":"asc";n.props.sortItems("size",t)},n}return Object(n.a)(i,[{key:"render",value:function(){var e=this,t=this.props,i=t.isDesktop,a=t.isLoading,n=t.errorMsg,o=t.items,s=t.sortBy,r=t.sortOrder,l=t.isAllItemsSelected;if(a)return Object(_.jsx)(j.a,{});if(n)return Object(_.jsx)("p",{className:"error mt-6 text-center",children:n});var c=Object(_.jsx)("tbody",{children:o.map((function(t,a){return Object(_.jsx)(oe,{isDesktop:i,item:t,zipDownloadFolder:e.props.zipDownloadFolder,showImagePopup:e.props.showImagePopup,toggleItemSelected:e.props.toggleItemSelected},a)}))});if(!i)return Object(_.jsxs)("table",{className:"table-hover table-thead-hidden",children:[Object(_.jsx)("thead",{children:Object(_.jsxs)("tr",{children:[Object(_.jsx)("th",{width:"12%"}),Object(_.jsx)("th",{width:"80%"}),Object(_.jsx)("th",{width:"8%"})]})}),c]});var d=Object(_.jsx)("span",{className:"fas ".concat("asc"==r?"fa-caret-up":"fa-caret-down")});return"list"==H?Object(_.jsxs)("table",{className:"table-hover",children:[Object(_.jsx)("thead",{children:Object(_.jsxs)("tr",{children:[ie&&Object(_.jsx)("th",{width:"3%",className:"text-center",children:Object(_.jsx)("input",{type:"checkbox",checked:l,onChange:this.props.toggleAllSelected})}),Object(_.jsx)("th",{width:"5%"}),Object(_.jsx)("th",{width:ie?"52%":"55%",children:Object(_.jsxs)("a",{className:"d-block table-sort-op",href:"#",onClick:this.sortByName,children:[Object(f.qb)("Name")," ","name"==s&&d]})}),Object(_.jsx)("th",{width:"14%",children:Object(_.jsxs)("a",{className:"d-block table-sort-op",href:"#",onClick:this.sortBySize,children:[Object(f.qb)("Size")," ","size"==s&&d]})}),Object(_.jsx)("th",{width:"16%",children:Object(_.jsxs)("a",{className:"d-block table-sort-op",href:"#",onClick:this.sortByTime,children:[Object(f.qb)("Last Update")," ","time"==s&&d]})}),Object(_.jsx)("th",{width:"10%"})]})}),c]}):Object(_.jsx)("ul",{className:"grid-view",children:o.map((function(t,i){return Object(_.jsx)(se,{item:t,zipDownloadFolder:e.props.zipDownloadFolder,showImagePopup:e.props.showImagePopup},i)}))})}}]),i}(c.a.Component),oe=function(e){Object(s.a)(i,e);var t=Object(r.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).toggleOpMenu=function(){n.setState({isOpMenuOpen:!n.state.isOpMenuOpen})},n.handleMouseOver=function(){n.setState({isIconShown:!0})},n.handleMouseOut=function(){n.setState({isIconShown:!1})},n.zipDownloadFolder=function(e){e.preventDefault(),n.props.zipDownloadFolder.bind(Object(o.a)(n),n.props.item.folder_path)()},n.handleFileClick=function(e){var t=n.props.item;g.a.imageCheck(t.file_name)&&(e.preventDefault(),n.props.showImagePopup(t))},n.toggleItemSelected=function(e){n.props.toggleItemSelected(n.props.item,e.target.checked)},n.state={isIconShown:!1,isOpMenuOpen:!1},n}return Object(n.a)(i,[{key:"render",value:function(){var e=this.props,t=e.item,i=e.isDesktop,a=this.state.isIconShown;if(t.is_dir)return i?Object(_.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[ie&&Object(_.jsx)("td",{className:"text-center",children:Object(_.jsx)("input",{type:"checkbox",checked:t.isSelected,onChange:this.toggleItemSelected})}),Object(_.jsx)("td",{className:"text-center",children:Object(_.jsx)("img",{src:g.a.getFolderIconUrl(),alt:"",width:"24"})}),Object(_.jsx)("td",{children:Object(_.jsx)("a",{href:"?p=".concat(encodeURIComponent(t.folder_path.substr(0,t.folder_path.length-1)),"&mode=").concat(H),children:t.folder_name})}),Object(_.jsx)("td",{}),Object(_.jsx)("td",{title:m()(t.last_modified).format("llll"),children:m()(t.last_modified).fromNow()}),Object(_.jsx)("td",{children:ie&&Object(_.jsx)("a",{role:"button",className:"action-icon sf2-icon-download".concat(a?"":" invisible"),href:"#",onClick:this.zipDownloadFolder,title:Object(f.qb)("Download"),"aria-label":Object(f.qb)("Download")})})]}):Object(_.jsxs)("tr",{children:[Object(_.jsx)("td",{className:"text-center",children:Object(_.jsx)("img",{src:g.a.getFolderIconUrl(),alt:"",width:"24"})}),Object(_.jsxs)("td",{children:[Object(_.jsx)("a",{href:"?p=".concat(encodeURIComponent(t.folder_path.substr(0,t.folder_path.length-1)),"&mode=").concat(H),children:t.folder_name}),Object(_.jsx)("br",{}),Object(_.jsx)("span",{className:"item-meta-info",children:m()(t.last_modified).fromNow()})]}),Object(_.jsx)("td",{children:ie&&Object(_.jsxs)(u.l,{isOpen:this.state.isOpMenuOpen,toggle:this.toggleOpMenu,children:[Object(_.jsx)(u.o,{tag:"i",className:"sf-dropdown-toggle fa fa-ellipsis-v ml-0",title:Object(f.qb)("More Operations"),"data-toggle":"dropdown","aria-expanded":this.state.isOpMenuOpen}),Object(_.jsxs)("div",{className:this.state.isOpMenuOpen?"":"d-none",onClick:this.toggleOpMenu,children:[Object(_.jsx)("div",{className:"mobile-operation-menu-bg-layer"}),Object(_.jsx)("div",{className:"mobile-operation-menu",children:Object(_.jsx)(u.m,{className:"mobile-menu-item",onClick:this.zipDownloadFolder,children:Object(f.qb)("Download")})})]})]})})]});var n="".concat(f.qc,"d/").concat(B,"/files/?p=").concat(encodeURIComponent(t.file_path)),o=t.encoded_thumbnail_src?"".concat(f.qc).concat(t.encoded_thumbnail_src):"";return i?Object(_.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[ie&&Object(_.jsx)("td",{className:"text-center",children:Object(_.jsx)("input",{type:"checkbox",checked:t.isSelected,onChange:this.toggleItemSelected})}),Object(_.jsx)("td",{className:"text-center",children:o?Object(_.jsx)("img",{className:"thumbnail",src:o,alt:""}):Object(_.jsx)("img",{src:g.a.getFileIconUrl(t.file_name),alt:"",width:"24"})}),Object(_.jsx)("td",{children:Object(_.jsx)("a",{href:n,onClick:this.handleFileClick,children:t.file_name})}),Object(_.jsx)("td",{children:g.a.bytesToSize(t.size)}),Object(_.jsx)("td",{title:m()(t.last_modified).format("llll"),children:m()(t.last_modified).fromNow()}),Object(_.jsx)("td",{children:ie&&Object(_.jsx)("a",{className:"action-icon sf2-icon-download".concat(a?"":" invisible"),href:"".concat(n,"&dl=1"),title:Object(f.qb)("Download"),"aria-label":Object(f.qb)("Download")})})]}):Object(_.jsxs)("tr",{children:[Object(_.jsx)("td",{className:"text-center",children:o?Object(_.jsx)("img",{className:"thumbnail",src:o,alt:""}):Object(_.jsx)("img",{src:g.a.getFileIconUrl(t.file_name),alt:"",width:"24"})}),Object(_.jsxs)("td",{children:[Object(_.jsx)("a",{href:n,onClick:this.handleFileClick,children:t.file_name}),Object(_.jsx)("br",{}),Object(_.jsx)("span",{className:"item-meta-info",children:g.a.bytesToSize(t.size)}),Object(_.jsx)("span",{className:"item-meta-info",children:m()(t.last_modified).fromNow()})]}),Object(_.jsx)("td",{children:ie&&Object(_.jsxs)(u.l,{isOpen:this.state.isOpMenuOpen,toggle:this.toggleOpMenu,children:[Object(_.jsx)(u.o,{tag:"i",className:"sf-dropdown-toggle fa fa-ellipsis-v ml-0",title:Object(f.qb)("More Operations"),"data-toggle":"dropdown","aria-expanded":this.state.isOpMenuOpen}),Object(_.jsxs)("div",{className:this.state.isOpMenuOpen?"":"d-none",onClick:this.toggleOpMenu,children:[Object(_.jsx)("div",{className:"mobile-operation-menu-bg-layer"}),Object(_.jsx)("div",{className:"mobile-operation-menu",children:Object(_.jsx)(u.m,{className:"mobile-menu-item",tag:"a",href:"".concat(n,"&dl=1"),children:Object(f.qb)("Download")})})]})]})})]})}}]),i}(c.a.Component),se=function(e){Object(s.a)(i,e);var t=Object(r.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).handleMouseOver=function(){n.setState({isIconShown:!0})},n.handleMouseOut=function(){n.setState({isIconShown:!1})},n.zipDownloadFolder=function(e){e.preventDefault(),n.props.zipDownloadFolder.bind(Object(o.a)(n),n.props.item.folder_path)()},n.handleFileClick=function(e){var t=n.props.item;g.a.imageCheck(t.file_name)&&(e.preventDefault(),n.props.showImagePopup(t))},n.state={isIconShown:!1},n}return Object(n.a)(i,[{key:"render",value:function(){var e=this.props.item,t=this.state.isIconShown;if(e.is_dir){var i="?p=".concat(encodeURIComponent(e.folder_path.substr(0,e.folder_path.length-1)),"&mode=").concat(H);return Object(_.jsxs)("li",{className:"grid-item",onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[Object(_.jsx)("a",{href:i,className:"grid-file-img-link d-block",children:Object(_.jsx)("img",{src:g.a.getFolderIconUrl(!1,192),alt:"",width:"96",height:"96"})}),Object(_.jsx)("a",{href:i,className:"grid-file-name grid-file-name-link",children:e.folder_name}),ie&&Object(_.jsx)("a",{role:"button",className:"action-icon sf2-icon-download".concat(t?"":" invisible"),href:"#",onClick:this.zipDownloadFolder,title:Object(f.qb)("Download"),"aria-label":Object(f.qb)("Download")})]})}var a="".concat(f.qc,"d/").concat(B,"/files/?p=").concat(encodeURIComponent(e.file_path)),n=e.encoded_thumbnail_src?"".concat(f.qc).concat(e.encoded_thumbnail_src):"";return Object(_.jsxs)("li",{className:"grid-item",onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[Object(_.jsx)("a",{href:a,className:"grid-file-img-link d-block",onClick:this.handleFileClick,children:n?Object(_.jsx)("img",{className:"thumbnail",src:n,alt:""}):Object(_.jsx)("img",{src:g.a.getFileIconUrl(e.file_name,192),alt:"",width:"96",height:"96"})}),Object(_.jsx)("a",{href:a,className:"grid-file-name grid-file-name-link",onClick:this.handleFileClick,children:e.file_name}),ie&&Object(_.jsx)("a",{className:"action-icon sf2-icon-download".concat(t?"":" invisible"),href:"".concat(a,"&dl=1"),title:Object(f.qb)("Download"),"aria-label":Object(f.qb)("Download")})]})}}]),i}(c.a.Component);h.a.render(Object(_.jsx)(ae,{}),document.getElementById("wrapper"))},170:function(e,t,i){"use strict";var a=i(6),n=i(7),o=i(9),s=i(8),r=i(2),l=i.n(r),c=i(1),d=i(318),h=(i(501),i(0)),u=function(e){Object(o.a)(i,e);var t=Object(s.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,e)}return Object(n.a)(i,[{key:"render",value:function(){var e=this.props.imageItems,t=this.props.imageIndex,i=e.length,a=i&&Object(h.jsxs)(r.Fragment,{children:[Object(h.jsx)("span",{children:Object(c.qb)("%curr% of %total%").replace("%curr%",t+1).replace("%total%",i)}),Object(h.jsx)("br",{}),Object(h.jsx)("a",{href:e[t].url,target:"_blank",children:Object(c.qb)("Open in New Tab")})]});return Object(h.jsx)(d.a,{mainSrc:e[t].src,imageTitle:e[t].name,imageCaption:a,nextSrc:e[(t+1)%i].src,prevSrc:e[(t+i-1)%i].src,onCloseRequest:this.props.closeImagePopup,onMovePrevRequest:this.props.moveToPrevImage,onMoveNextRequest:this.props.moveToNextImage,imagePadding:70,imageLoadErrorMessage:Object(c.qb)("The image could not be loaded."),prevLabel:Object(c.qb)("Previous (Left arrow key)"),nextLabel:Object(c.qb)("Next (Right arrow key)"),closeLabel:Object(c.qb)("Close (Esc)"),zoomInLabel:Object(c.qb)("Zoom in"),zoomOutLabel:Object(c.qb)("Zoom out")})}}]),i}(l.a.Component);t.a=u},318:function(e,t,i){"use strict";(function(e){var a=i(2),n=i.n(a),o=i(3),s=i.n(o),r=i(246),l=i.n(r);function c(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function d(e,t,i){return t&&c(e.prototype,t),i&&c(e,i),e}function h(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e}).apply(this,arguments)}function p(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function m(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?p(Object(i),!0).forEach((function(t){h(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):p(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e))&&"[object Arguments]"!==Object.prototype.toString.call(e))return;var i=[],a=!0,n=!1,o=void 0;try{for(var s,r=e[Symbol.iterator]();!(a=(s=r.next()).done)&&(i.push(s.value),!t||i.length!==t);a=!0);}catch(l){n=!0,o=l}finally{try{a||null==r.return||r.return()}finally{if(n)throw o}}return i}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function j(e){return function(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return"";var i=e;return t&&Object.keys(t).forEach((function(e){i=i.replace(e,t[e])})),i}function x(){return"undefined"!==typeof e.window?e.window.innerWidth:0}function S(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.window.self,i=t.document.referrer;if(t===e.window.top||!i)return t;var a=function(e){return e.match(/(.*\/\/.*?)(\/|$)/)[1]};return a(t.location.href)===a(i)?S(t.parent):t}var y=300,k=27,w=37,C=39,I=function(t){function i(e){var t,a,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),a=this,t=!(o=b(i).call(this,e))||"object"!==typeof o&&"function"!==typeof o?g(a):o,h(g(t),"handleWheel",(function(e){e.preventDefault()})),t.state={isClosing:!e.animationDisabled,shouldAnimate:!1,zoomLevel:0,offsetX:0,offsetY:0,loadErrorStatus:{}},t.outerEl=n.a.createRef(),t.zoomInBtn=n.a.createRef(),t.zoomOutBtn=n.a.createRef(),t.caption=n.a.createRef(),t.closeIfClickInner=t.closeIfClickInner.bind(g(t)),t.handleImageDoubleClick=t.handleImageDoubleClick.bind(g(t)),t.handleImageMouseWheel=t.handleImageMouseWheel.bind(g(t)),t.handleKeyInput=t.handleKeyInput.bind(g(t)),t.handleMouseUp=t.handleMouseUp.bind(g(t)),t.handleMouseDown=t.handleMouseDown.bind(g(t)),t.handleMouseMove=t.handleMouseMove.bind(g(t)),t.handleOuterMousewheel=t.handleOuterMousewheel.bind(g(t)),t.handleTouchStart=t.handleTouchStart.bind(g(t)),t.handleTouchMove=t.handleTouchMove.bind(g(t)),t.handleTouchEnd=t.handleTouchEnd.bind(g(t)),t.handlePointerEvent=t.handlePointerEvent.bind(g(t)),t.handleCaptionMousewheel=t.handleCaptionMousewheel.bind(g(t)),t.handleWindowResize=t.handleWindowResize.bind(g(t)),t.handleZoomInButtonClick=t.handleZoomInButtonClick.bind(g(t)),t.handleZoomOutButtonClick=t.handleZoomOutButtonClick.bind(g(t)),t.requestClose=t.requestClose.bind(g(t)),t.requestMoveNext=t.requestMoveNext.bind(g(t)),t.requestMovePrev=t.requestMovePrev.bind(g(t)),t}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(i,t),d(i,null,[{key:"isTargetMatchImage",value:function(e){return e&&/ril-image-current/.test(e.className)}},{key:"parseMouseEvent",value:function(e){return{id:"mouse",source:1,x:parseInt(e.clientX,10),y:parseInt(e.clientY,10)}}},{key:"parseTouchPointer",value:function(e){return{id:e.identifier,source:2,x:parseInt(e.clientX,10),y:parseInt(e.clientY,10)}}},{key:"parsePointerEvent",value:function(e){return{id:e.pointerId,source:3,x:parseInt(e.clientX,10),y:parseInt(e.clientY,10)}}},{key:"getTransform",value:function(e){var t=e.x,i=void 0===t?0:t,a=e.y,n=void 0===a?0:a,o=e.zoom,s=void 0===o?1:o,r=e.width,l=e.targetWidth,c=i,d=x();r>d&&(c+=(d-r)/2);var h=s*(l/r);return{transform:"translate3d(".concat(c,"px,").concat(n,"px,0) scale3d(").concat(h,",").concat(h,",1)")}}}]),d(i,[{key:"UNSAFE_componentWillMount",value:function(){this.timeouts=[],this.currentAction=0,this.eventsSource=0,this.pointerList=[],this.preventInnerClose=!1,this.preventInnerCloseTimeout=null,this.keyPressed=!1,this.imageCache={},this.lastKeyDownTime=0,this.resizeTimeout=null,this.wheelActionTimeout=null,this.resetScrollTimeout=null,this.scrollX=0,this.scrollY=0,this.moveStartX=0,this.moveStartY=0,this.moveStartOffsetX=0,this.moveStartOffsetY=0,this.swipeStartX=0,this.swipeStartY=0,this.swipeEndX=0,this.swipeEndY=0,this.pinchTouchList=null,this.pinchDistance=0,this.keyCounter=0,this.moveRequested=!1,this.props.animationDisabled||this.setState({isClosing:!1})}},{key:"componentDidMount",value:function(){var e=this;this.windowContext=S(),this.listeners={resize:this.handleWindowResize,mouseup:this.handleMouseUp,touchend:this.handleTouchEnd,touchcancel:this.handleTouchEnd,pointerdown:this.handlePointerEvent,pointermove:this.handlePointerEvent,pointerup:this.handlePointerEvent,pointercancel:this.handlePointerEvent},Object.keys(this.listeners).forEach((function(t){e.windowContext.addEventListener(t,e.listeners[t])})),document.addEventListener("wheel",this.handleWheel,{passive:!1}),this.loadAllImages()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this,i=!1,a={},n={};this.getSrcTypes().forEach((function(o){t.props[o.name]!==e[o.name]&&(i=!0,a[t.props[o.name]]=!0,n[e[o.name]]=!0)})),(i||this.moveRequested)&&(Object.keys(a).forEach((function(e){!(e in n)&&e in t.imageCache&&(t.imageCache[e].loaded=!1)})),this.moveRequested=!1,this.loadAllImages(e))}},{key:"shouldComponentUpdate",value:function(){return!this.moveRequested}},{key:"componentWillUnmount",value:function(){var e=this;this.didUnmount=!0,Object.keys(this.listeners).forEach((function(t){e.windowContext.removeEventListener(t,e.listeners[t])})),document.removeEventListener("wheel",this.handleWheel,{passive:!1}),this.timeouts.forEach((function(e){return clearTimeout(e)}))}},{key:"setTimeout",value:function(e){function t(t,i){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){var i=this,a=setTimeout((function(){i.timeouts=i.timeouts.filter((function(e){return e!==a})),e()}),t);return this.timeouts.push(a),a}))},{key:"setPreventInnerClose",value:function(){var e=this;this.preventInnerCloseTimeout&&this.clearTimeout(this.preventInnerCloseTimeout),this.preventInnerClose=!0,this.preventInnerCloseTimeout=this.setTimeout((function(){e.preventInnerClose=!1,e.preventInnerCloseTimeout=null}),100)}},{key:"getBestImageForType",value:function(e){var t=this.props[e],i={};if(this.isImageLoaded(t))i=this.getFitSizes(this.imageCache[t].width,this.imageCache[t].height);else{if(!this.isImageLoaded(this.props["".concat(e,"Thumbnail")]))return null;t=this.props["".concat(e,"Thumbnail")],i=this.getFitSizes(this.imageCache[t].width,this.imageCache[t].height,!0)}return{src:t,height:this.imageCache[t].height,width:this.imageCache[t].width,targetHeight:i.height,targetWidth:i.width}}},{key:"getFitSizes",value:function(e,t,i){var a=this.getLightboxRect(),n=a.height-2*this.props.imagePadding,o=a.width-2*this.props.imagePadding;return i||(n=Math.min(n,t),o=Math.min(o,e)),o/n>e/t?{width:e*n/t,height:n}:{width:o,height:t*o/e}}},{key:"getMaxOffsets",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.zoomLevel,t=this.getBestImageForType("mainSrc");if(null===t)return{maxX:0,minX:0,maxY:0,minY:0};var i=this.getLightboxRect(),a=this.getZoomMultiplier(e),n=0,o=0;return{maxX:n=a*t.width-i.width<0?(i.width-a*t.width)/2:(a*t.width-i.width)/2,maxY:o=a*t.height-i.height<0?(i.height-a*t.height)/2:(a*t.height-i.height)/2,minX:-1*n,minY:-1*o}}},{key:"getSrcTypes",value:function(){return[{name:"mainSrc",keyEnding:"i".concat(this.keyCounter)},{name:"mainSrcThumbnail",keyEnding:"t".concat(this.keyCounter)},{name:"nextSrc",keyEnding:"i".concat(this.keyCounter+1)},{name:"nextSrcThumbnail",keyEnding:"t".concat(this.keyCounter+1)},{name:"prevSrc",keyEnding:"i".concat(this.keyCounter-1)},{name:"prevSrcThumbnail",keyEnding:"t".concat(this.keyCounter-1)}]}},{key:"getZoomMultiplier",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.zoomLevel;return Math.pow(1.007,e)}},{key:"getLightboxRect",value:function(){return this.outerEl.current?this.outerEl.current.getBoundingClientRect():{width:x(),height:"undefined"!==typeof e.window?e.window.innerHeight:0,top:0,right:0,bottom:0,left:0}}},{key:"clearTimeout",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){this.timeouts=this.timeouts.filter((function(t){return t!==e})),clearTimeout(e)}))},{key:"changeZoom",value:function(e,t,i){if(this.props.enableZoom){var a=Math.max(0,Math.min(y,e));if(a!==this.state.zoomLevel)if(0!==a){var n=this.getBestImageForType("mainSrc");if(null!==n){var o=this.getZoomMultiplier(),s=this.getZoomMultiplier(a),r=this.getLightboxRect(),l="undefined"!==typeof t?t-r.left:r.width/2,c="undefined"!==typeof i?i-r.top:r.height/2,d=(r.width-n.width*o)/2,h=(r.height-n.height*o)/2,u=l-(l-(d-this.state.offsetX))/o*s,p=c-(c-(h-this.state.offsetY))/o*s,m=(r.width-n.width*s)/2-u,b=(r.height-n.height*s)/2-p;if(3!==this.currentAction){var f=this.getMaxOffsets();this.state.zoomLevel>a&&(m=Math.max(f.minX,Math.min(f.maxX,m)),b=Math.max(f.minY,Math.min(f.maxY,b)))}this.setState({zoomLevel:a,offsetX:m,offsetY:b})}}else this.setState({zoomLevel:a,offsetX:0,offsetY:0})}}},{key:"closeIfClickInner",value:function(e){!this.preventInnerClose&&e.target.className.search(/\bril-inner\b/)>-1&&this.requestClose(e)}},{key:"handleKeyInput",value:function(e){if(e.stopPropagation(),!this.isAnimating())if("keyup"!==e.type){var t=e.which||e.keyCode,i=new Date;if(!(i.getTime()-this.lastKeyDownTime<this.props.keyRepeatLimit&&t!==k))switch(this.lastKeyDownTime=i.getTime(),t){case k:e.preventDefault(),this.requestClose(e);break;case w:if(!this.props.prevSrc)return;e.preventDefault(),this.keyPressed=!0,this.requestMovePrev(e);break;case C:if(!this.props.nextSrc)return;e.preventDefault(),this.keyPressed=!0,this.requestMoveNext(e)}}else this.lastKeyDownTime-=this.props.keyRepeatKeyupBonus}},{key:"handleOuterMousewheel",value:function(e){var t=this;e.stopPropagation(),this.clearTimeout(this.resetScrollTimeout),this.resetScrollTimeout=this.setTimeout((function(){t.scrollX=0,t.scrollY=0}),300)}},{key:"handleImageMouseWheel",value:function(e){if(parseInt(e.deltaY)!==parseFloat(e.deltaY)){if(Math.abs(e.deltaY)>=Math.abs(e.deltaX)){if(e.stopPropagation(),Math.abs(e.deltaY)<1)return;this.scrollX=0,this.scrollY+=e.deltaY,this.changeZoom(this.state.zoomLevel-e.deltaY,e.clientX,e.clientY)}}else if(Math.abs(e.deltaY)>Math.abs(e.deltaX)){var t=this.state.offsetY+e.deltaY;this.setState({offsetY:t})}else{var i=this.state.offsetX+e.deltaX;this.setState({offsetX:i})}}},{key:"handleImageDoubleClick",value:function(e){this.state.zoomLevel>0?this.changeZoom(0,e.clientX,e.clientY):this.changeZoom(this.state.zoomLevel+100,e.clientX,e.clientY)}},{key:"shouldHandleEvent",value:function(e){if(this.eventsSource===e)return!0;if(0===this.eventsSource)return this.eventsSource=e,!0;switch(e){case 1:return!1;case 2:return this.eventsSource=2,this.filterPointersBySource(),!0;case 3:return 1===this.eventsSource&&(this.eventsSource=3,this.filterPointersBySource(),!0);default:return!1}}},{key:"addPointer",value:function(e){this.pointerList.push(e)}},{key:"removePointer",value:function(e){this.pointerList=this.pointerList.filter((function(t){return t.id!==e.id}))}},{key:"filterPointersBySource",value:function(){var e=this;this.pointerList=this.pointerList.filter((function(t){return t.source===e.eventsSource}))}},{key:"handleMouseDown",value:function(e){this.shouldHandleEvent(1)&&i.isTargetMatchImage(e.target)&&(this.addPointer(i.parseMouseEvent(e)),this.multiPointerStart(e))}},{key:"handleMouseMove",value:function(e){this.shouldHandleEvent(1)&&this.multiPointerMove(e,[i.parseMouseEvent(e)])}},{key:"handleMouseUp",value:function(e){this.shouldHandleEvent(1)&&(this.removePointer(i.parseMouseEvent(e)),this.multiPointerEnd(e))}},{key:"handlePointerEvent",value:function(e){if(this.shouldHandleEvent(3))switch(e.type){case"pointerdown":i.isTargetMatchImage(e.target)&&(this.addPointer(i.parsePointerEvent(e)),this.multiPointerStart(e));break;case"pointermove":this.multiPointerMove(e,[i.parsePointerEvent(e)]);break;case"pointerup":case"pointercancel":this.removePointer(i.parsePointerEvent(e)),this.multiPointerEnd(e)}}},{key:"handleTouchStart",value:function(e){var t=this;this.shouldHandleEvent(2)&&i.isTargetMatchImage(e.target)&&([].forEach.call(e.changedTouches,(function(e){return t.addPointer(i.parseTouchPointer(e))})),this.multiPointerStart(e))}},{key:"handleTouchMove",value:function(e){this.shouldHandleEvent(2)&&this.multiPointerMove(e,[].map.call(e.changedTouches,(function(e){return i.parseTouchPointer(e)})))}},{key:"handleTouchEnd",value:function(e){var t=this;this.shouldHandleEvent(2)&&([].map.call(e.changedTouches,(function(e){return t.removePointer(i.parseTouchPointer(e))})),this.multiPointerEnd(e))}},{key:"decideMoveOrSwipe",value:function(e){this.state.zoomLevel<=0?this.handleSwipeStart(e):this.handleMoveStart(e)}},{key:"multiPointerStart",value:function(e){switch(this.handleEnd(null),this.pointerList.length){case 1:e.preventDefault(),this.decideMoveOrSwipe(this.pointerList[0]);break;case 2:e.preventDefault(),this.handlePinchStart(this.pointerList)}}},{key:"multiPointerMove",value:function(e,t){switch(this.currentAction){case 1:e.preventDefault(),this.handleMove(t[0]);break;case 2:e.preventDefault(),this.handleSwipe(t[0]);break;case 3:e.preventDefault(),this.handlePinch(t)}}},{key:"multiPointerEnd",value:function(e){switch(0!==this.currentAction&&(this.setPreventInnerClose(),this.handleEnd(e)),this.pointerList.length){case 0:this.eventsSource=0;break;case 1:e.preventDefault(),this.decideMoveOrSwipe(this.pointerList[0]);break;case 2:e.preventDefault(),this.handlePinchStart(this.pointerList)}}},{key:"handleEnd",value:function(e){switch(this.currentAction){case 1:this.handleMoveEnd(e);break;case 2:this.handleSwipeEnd(e);break;case 3:this.handlePinchEnd(e)}}},{key:"handleMoveStart",value:function(e){var t=e.x,i=e.y;this.props.enableZoom&&(this.currentAction=1,this.moveStartX=t,this.moveStartY=i,this.moveStartOffsetX=this.state.offsetX,this.moveStartOffsetY=this.state.offsetY)}},{key:"handleMove",value:function(e){var t=e.x,i=e.y,a=this.moveStartX-t+this.moveStartOffsetX,n=this.moveStartY-i+this.moveStartOffsetY;this.state.offsetX===a&&this.state.offsetY===n||this.setState({offsetX:a,offsetY:n})}},{key:"handleMoveEnd",value:function(){var e=this;this.currentAction=0,this.moveStartX=0,this.moveStartY=0,this.moveStartOffsetX=0,this.moveStartOffsetY=0;var t=this.getMaxOffsets(),i=Math.max(t.minX,Math.min(t.maxX,this.state.offsetX)),a=Math.max(t.minY,Math.min(t.maxY,this.state.offsetY));i===this.state.offsetX&&a===this.state.offsetY||(this.setState({offsetX:i,offsetY:a,shouldAnimate:!0}),this.setTimeout((function(){e.setState({shouldAnimate:!1})}),this.props.animationDuration))}},{key:"handleSwipeStart",value:function(e){var t=e.x,i=e.y;this.currentAction=2,this.swipeStartX=t,this.swipeStartY=i,this.swipeEndX=t,this.swipeEndY=i}},{key:"handleSwipe",value:function(e){var t=e.x,i=e.y;this.swipeEndX=t,this.swipeEndY=i}},{key:"handleSwipeEnd",value:function(e){var t=this.swipeEndX-this.swipeStartX,i=Math.abs(t),a=Math.abs(this.swipeEndY-this.swipeStartY);if(this.currentAction=0,this.swipeStartX=0,this.swipeStartY=0,this.swipeEndX=0,this.swipeEndY=0,!(!e||this.isAnimating()||i<1.5*a)){if(i<200)if(i<this.getLightboxRect().width/4)return;t>0&&this.props.prevSrc?(e.preventDefault(),this.requestMovePrev()):t<0&&this.props.nextSrc&&(e.preventDefault(),this.requestMoveNext())}}},{key:"calculatePinchDistance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pinchTouchList,t=v(e,2),i=t[0],a=t[1];return Math.sqrt(Math.pow(i.x-a.x,2)+Math.pow(i.y-a.y,2))}},{key:"calculatePinchCenter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.pinchTouchList,t=v(e,2),i=t[0],a=t[1];return{x:i.x-(i.x-a.x)/2,y:i.y-(i.y-a.y)/2}}},{key:"handlePinchStart",value:function(e){this.props.enableZoom&&(this.currentAction=3,this.pinchTouchList=e.map((function(e){return{id:e.id,x:e.x,y:e.y}})),this.pinchDistance=this.calculatePinchDistance())}},{key:"handlePinch",value:function(e){this.pinchTouchList=this.pinchTouchList.map((function(t){for(var i=0;i<e.length;i+=1)if(e[i].id===t.id)return e[i];return t}));var t=this.calculatePinchDistance(),i=this.state.zoomLevel+t-this.pinchDistance;this.pinchDistance=t;var a=this.calculatePinchCenter(this.pinchTouchList),n=a.x,o=a.y;this.changeZoom(i,n,o)}},{key:"handlePinchEnd",value:function(){this.currentAction=0,this.pinchTouchList=null,this.pinchDistance=0}},{key:"handleWindowResize",value:function(){this.clearTimeout(this.resizeTimeout),this.resizeTimeout=this.setTimeout(this.forceUpdate.bind(this),100)}},{key:"handleZoomInButtonClick",value:function(){var e=this.state.zoomLevel+100;this.changeZoom(e),e===y&&this.zoomOutBtn.current.focus()}},{key:"handleZoomOutButtonClick",value:function(){var e=this.state.zoomLevel-100;this.changeZoom(e),0===e&&this.zoomInBtn.current.focus()}},{key:"handleCaptionMousewheel",value:function(e){if(e.stopPropagation(),this.caption.current){var t=this.caption.current.getBoundingClientRect().height,i=this.caption.current,a=i.scrollHeight,n=i.scrollTop;(e.deltaY>0&&t+n>=a||e.deltaY<0&&n<=0)&&e.preventDefault()}}},{key:"isAnimating",value:function(){return this.state.shouldAnimate||this.state.isClosing}},{key:"isImageLoaded",value:function(e){return e&&e in this.imageCache&&this.imageCache[e].loaded}},{key:"loadImage",value:function(t,i,a){var n=this;if(this.isImageLoaded(i))this.setTimeout((function(){a()}),1);else{var o=new e.Image;this.props.imageCrossOrigin&&(o.crossOrigin=this.props.imageCrossOrigin),o.onerror=function(e){n.props.onImageLoadError(i,t,e),n.setState((function(e){return{loadErrorStatus:m({},e.loadErrorStatus,h({},t,!0))}})),a(e)},o.onload=function(){n.props.onImageLoad(i,t,o),n.imageCache[i]={loaded:!0,width:o.width,height:o.height},a()},o.src=i}}},{key:"loadAllImages",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props,i=function(t,i){return function(a){a||e.props[t]!==i||e.didUnmount||e.forceUpdate()}};this.getSrcTypes().forEach((function(a){var n=a.name;t[n]&&e.state.loadErrorStatus[n]&&e.setState((function(e){return{loadErrorStatus:m({},e.loadErrorStatus,h({},n,!1))}})),t[n]&&!e.isImageLoaded(t[n])&&e.loadImage(n,t[n],i(n,t[n]))}))}},{key:"requestClose",value:function(e){var t=this,i=function(){return t.props.onCloseRequest(e)};this.props.animationDisabled||"keydown"===e.type&&!this.props.animationOnKeyInput?i():(this.setState({isClosing:!0}),this.setTimeout(i,this.props.animationDuration))}},{key:"requestMove",value:function(e,t){var i=this,a={zoomLevel:0,offsetX:0,offsetY:0};this.props.animationDisabled||this.keyPressed&&!this.props.animationOnKeyInput||(a.shouldAnimate=!0,this.setTimeout((function(){return i.setState({shouldAnimate:!1})}),this.props.animationDuration)),this.keyPressed=!1,this.moveRequested=!0,"prev"===e?(this.keyCounter-=1,this.setState(a),this.props.onMovePrevRequest(t)):(this.keyCounter+=1,this.setState(a),this.props.onMoveNextRequest(t))}},{key:"requestMoveNext",value:function(e){this.requestMove("next",e)}},{key:"requestMovePrev",value:function(e){this.requestMove("prev",e)}},{key:"render",value:function(){var t=this,a=this.props,o=a.animationDisabled,s=a.animationDuration,r=a.clickOutsideToClose,c=a.discourageDownloads,d=a.enableZoom,h=a.imageTitle,p=a.nextSrc,b=a.prevSrc,f=a.toolbarButtons,g=a.reactModalStyle,v=a.onAfterOpen,x=a.imageCrossOrigin,S=a.reactModalProps,k=this.state,w=k.zoomLevel,C=k.offsetX,I=k.offsetY,M=k.isClosing,_=k.loadErrorStatus,P=this.getLightboxRect(),D={};!o&&this.isAnimating()&&(D=m({},D,{transition:"transform ".concat(s,"ms")}));var F={};this.getSrcTypes().forEach((function(e){var t=e.name,i=e.keyEnding;F[t]=i}));var N=[],L=function(e,a,o){if(t.props[e]){var s=t.getBestImageForType(e),r=m({},D,{},i.getTransform(m({},o,{},s)));w>0&&(r.cursor="move");var l;if(null===s&&(l=_,Object.keys(l).some((function(e){return l[e]}))))N.push(n.a.createElement("div",{className:"".concat(a," ril__image ril-errored"),style:r,key:t.props[e]+F[e]},n.a.createElement("div",{className:"ril__errorContainer"},t.props.imageLoadErrorMessage)));else if(null!==s){var d=s.src;c?(r.backgroundImage="url('".concat(d,"')"),N.push(n.a.createElement("div",{className:"".concat(a," ril__image ril__imageDiscourager"),onDoubleClick:t.handleImageDoubleClick,onWheel:t.handleImageMouseWheel,style:r,key:d+F[e]},n.a.createElement("div",{className:"ril-download-blocker ril__downloadBlocker"})))):N.push(n.a.createElement("img",u({},x?{crossOrigin:x}:{},{className:"".concat(a," ril__image"),onDoubleClick:t.handleImageDoubleClick,onWheel:t.handleImageMouseWheel,onDragStart:function(e){return e.preventDefault()},style:r,src:d,key:d+F[e],alt:"string"===typeof h?h:O("Image"),draggable:!1})))}else{var p=n.a.createElement("div",{className:"ril-loading-circle ril__loadingCircle ril__loadingContainer__icon"},j(new Array(12)).map((function(e,t){return n.a.createElement("div",{key:t,className:"ril-loading-circle-point ril__loadingCirclePoint"})})));N.push(n.a.createElement("div",{className:"".concat(a," ril__image ril-not-loaded"),style:r,key:t.props[e]+F[e]},n.a.createElement("div",{className:"ril__loadingContainer"},p)))}}},E=this.getZoomMultiplier();L("nextSrc","ril-image-next ril__imageNext",{x:P.width}),L("mainSrc","ril-image-current",{x:-1*C,y:-1*I,zoom:E}),L("prevSrc","ril-image-prev ril__imagePrev",{x:-1*P.width});var U={overlay:m({zIndex:1e3,backgroundColor:"transparent"},g.overlay),content:m({backgroundColor:"transparent",overflow:"hidden",border:"none",borderRadius:0,padding:0,top:0,left:0,right:0,bottom:0},g.content)};return n.a.createElement(l.a,u({isOpen:!0,onRequestClose:r?this.requestClose:void 0,onAfterOpen:function(){t.outerEl.current&&t.outerEl.current.focus(),v()},style:U,contentLabel:O("Lightbox"),appElement:"undefined"!==typeof e.window?e.window.document.body:void 0},S),n.a.createElement("div",{className:"ril-outer ril__outer ril__outerAnimating ".concat(this.props.wrapperClassName," ").concat(M?"ril-closing ril__outerClosing":""),style:{transition:"opacity ".concat(s,"ms"),animationDuration:"".concat(s,"ms"),animationDirection:M?"normal":"reverse"},ref:this.outerEl,onWheel:this.handleOuterMousewheel,onMouseMove:this.handleMouseMove,onMouseDown:this.handleMouseDown,onTouchStart:this.handleTouchStart,onTouchMove:this.handleTouchMove,tabIndex:"-1",onKeyDown:this.handleKeyInput,onKeyUp:this.handleKeyInput},n.a.createElement("div",{className:"ril-inner ril__inner",onClick:r?this.closeIfClickInner:void 0},N),b&&n.a.createElement("button",{type:"button",className:"ril-prev-button ril__navButtons ril__navButtonPrev",key:"prev","aria-label":this.props.prevLabel,onClick:this.isAnimating()?void 0:this.requestMovePrev}),p&&n.a.createElement("button",{type:"button",className:"ril-next-button ril__navButtons ril__navButtonNext",key:"next","aria-label":this.props.nextLabel,onClick:this.isAnimating()?void 0:this.requestMoveNext}),n.a.createElement("div",{className:"ril-toolbar ril__toolbar"},n.a.createElement("ul",{className:"ril-toolbar-left ril__toolbarSide ril__toolbarLeftSide"},n.a.createElement("li",{className:"ril-toolbar__item ril__toolbarItem"},n.a.createElement("span",{className:"ril-toolbar__item__child ril__toolbarItemChild"},h))),n.a.createElement("ul",{className:"ril-toolbar-right ril__toolbarSide ril__toolbarRightSide"},f&&f.map((function(e,t){return n.a.createElement("li",{key:"button_".concat(t+1),className:"ril-toolbar__item ril__toolbarItem"},e)})),d&&n.a.createElement("li",{className:"ril-toolbar__item ril__toolbarItem"},n.a.createElement("button",{type:"button",key:"zoom-in","aria-label":this.props.zoomInLabel,className:["ril-zoom-in","ril__toolbarItemChild","ril__builtinButton","ril__zoomInButton"].concat(j(w===y?["ril__builtinButtonDisabled"]:[])).join(" "),ref:this.zoomInBtn,disabled:this.isAnimating()||w===y,onClick:this.isAnimating()||w===y?void 0:this.handleZoomInButtonClick})),d&&n.a.createElement("li",{className:"ril-toolbar__item ril__toolbarItem"},n.a.createElement("button",{type:"button",key:"zoom-out","aria-label":this.props.zoomOutLabel,className:["ril-zoom-out","ril__toolbarItemChild","ril__builtinButton","ril__zoomOutButton"].concat(j(0===w?["ril__builtinButtonDisabled"]:[])).join(" "),ref:this.zoomOutBtn,disabled:this.isAnimating()||0===w,onClick:this.isAnimating()||0===w?void 0:this.handleZoomOutButtonClick})),n.a.createElement("li",{className:"ril-toolbar__item ril__toolbarItem"},n.a.createElement("button",{type:"button",key:"close","aria-label":this.props.closeLabel,className:"ril-close ril-toolbar__item__child ril__toolbarItemChild ril__builtinButton ril__closeButton",onClick:this.isAnimating()?void 0:this.requestClose})))),this.props.imageCaption&&n.a.createElement("div",{onWheel:this.handleCaptionMousewheel,onMouseDown:function(e){return e.stopPropagation()},className:"ril-caption ril__caption",ref:this.caption},n.a.createElement("div",{className:"ril-caption-content ril__captionContent"},this.props.imageCaption))))}}]),i}(a.Component);I.propTypes={mainSrc:s.a.string.isRequired,prevSrc:s.a.string,nextSrc:s.a.string,mainSrcThumbnail:s.a.string,prevSrcThumbnail:s.a.string,nextSrcThumbnail:s.a.string,onCloseRequest:s.a.func.isRequired,onMovePrevRequest:s.a.func,onMoveNextRequest:s.a.func,onImageLoadError:s.a.func,onImageLoad:s.a.func,onAfterOpen:s.a.func,discourageDownloads:s.a.bool,animationDisabled:s.a.bool,animationOnKeyInput:s.a.bool,animationDuration:s.a.number,keyRepeatLimit:s.a.number,keyRepeatKeyupBonus:s.a.number,imageTitle:s.a.node,imageCaption:s.a.node,imageCrossOrigin:s.a.string,reactModalStyle:s.a.object,imagePadding:s.a.number,wrapperClassName:s.a.string,toolbarButtons:s.a.arrayOf(s.a.node),clickOutsideToClose:s.a.bool,enableZoom:s.a.bool,reactModalProps:s.a.shape({}),nextLabel:s.a.string,prevLabel:s.a.string,zoomInLabel:s.a.string,zoomOutLabel:s.a.string,closeLabel:s.a.string,imageLoadErrorMessage:s.a.node},I.defaultProps={imageTitle:null,imageCaption:null,toolbarButtons:null,reactModalProps:{},animationDisabled:!1,animationDuration:300,animationOnKeyInput:!1,clickOutsideToClose:!0,closeLabel:"Close lightbox",discourageDownloads:!1,enableZoom:!0,imagePadding:10,imageCrossOrigin:null,keyRepeatKeyupBonus:40,keyRepeatLimit:180,mainSrcThumbnail:null,nextLabel:"Next image",nextSrc:null,nextSrcThumbnail:null,onAfterOpen:function(){},onImageLoadError:function(){},onImageLoad:function(){},onMoveNextRequest:function(){},onMovePrevRequest:function(){},prevLabel:"Previous image",prevSrc:null,prevSrcThumbnail:null,reactModalStyle:{},wrapperClassName:"",zoomInLabel:"Zoom in",zoomOutLabel:"Zoom out",imageLoadErrorMessage:"This image failed to load"},t.a=I}).call(this,i(80))},501:function(e,t,i){},502:function(e,t,i){}},[[1514,1,0]]]);
//# sourceMappingURL=sharedDirView.chunk.js.map