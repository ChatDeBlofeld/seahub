(this["webpackJsonpseahub-frontend"]=this["webpackJsonpseahub-frontend"]||[]).push([[14],{1735:function(e,t,s){s(75),e.exports=s(1762)},1736:function(e,t,s){},1762:function(e,t,s){"use strict";s.r(t);var r=s(3),n=s(5),a=s(32),c=s(7),o=s(6),i=s(2),l=s.n(i),d=s(31),h=s.n(d),b=s(21),j=s(12),u=s.n(j),O=s(4),m=s(1),p=s(8),f=s(19),g=s(23),x=s(10),v=s(69),D=s(108),M=s(96),k=s(97),F=s(131),S=s(298),w=s(0),C=function(e){Object(c.a)(s,e);var t=Object(o.a)(s);function s(e){var n;return Object(r.a)(this,s),(n=t.call(this,e)).handleInputChange=function(e){n.setState({inputValue:e})},n.formSubmit=function(){var e=n.state.inputValue,t=n.props.repoID;n.setState({submitBtnDisabled:!0}),p.a.deleteRepoTrash(t,e.value).then((function(e){x.a.success(Object(m.sb)("Clean succeeded.")),n.props.refreshTrash(),n.props.toggleDialog()})).catch((function(e){var t=O.a.getErrorMsg(e);n.setState({formErrorMsg:t,submitBtnDisabled:!1})}))},n.options=[{label:Object(m.sb)("3 days ago"),value:3},{label:Object(m.sb)("1 week ago"),value:7},{label:Object(m.sb)("1 month ago"),value:30},{label:Object(m.sb)("all"),value:0}],n.state={inputValue:n.options[0],submitBtnDisabled:!1},n}return Object(n.a)(s,[{key:"render",value:function(){var e=this.state.formErrorMsg;return Object(w.jsxs)(D.a,{isOpen:!0,centered:!0,toggle:this.props.toggleDialog,children:[Object(w.jsx)(M.a,{toggle:this.props.toggleDialog,children:Object(m.sb)("Clean")}),Object(w.jsx)(k.a,{children:Object(w.jsxs)(l.a.Fragment,{children:[Object(w.jsx)("p",{children:Object(m.sb)("Clear files in trash and history\uff1a")}),Object(w.jsx)(S.a,{defaultValue:this.options[0],options:this.options,autoFocus:!1,onChange:this.handleInputChange,placeholder:""}),e&&Object(w.jsx)("p",{className:"error m-0 mt-2",children:e})]})}),Object(w.jsx)(F.a,{children:Object(w.jsx)("button",{className:"btn btn-primary",disabled:this.state.submitBtnDisabled,onClick:this.formSubmit,children:Object(m.sb)("Submit")})})]})}}]),s}(l.a.Component),I=(s(152),s(170),s(1736),window.app.pageOptions),_=I.repoID,N=I.repoFolderName,y=I.path,T=I.enableClean,L=function(e){Object(c.a)(s,e);var t=Object(o.a)(s);function s(e){var n;return Object(r.a)(this,s),(n=t.call(this,e)).getItems=function(e){p.a.getRepoFolderTrash(_,y,e).then((function(e){var t=e.data,s=t.data,r=t.more,a=t.scan_stat;!s.length&&r?n.getItems(a):n.setState({isLoading:!1,items:n.state.items.concat(s),more:r,scanStat:a})})).catch((function(e){n.setState({isLoading:!1,errorMsg:O.a.getErrorMsg(e,!0)})}))},n.getMore=function(){n.setState({isLoading:!0}),n.getItems(n.state.scanStat)},n.onSearchedClick=function(e){if(!0===e.is_dir){var t=m.uc+"library/"+e.repo_id+"/"+e.repo_name+e.path;Object(b.c)(t,{repalce:!0})}else{var s=m.uc+"lib/"+e.repo_id+"/file"+O.a.encodePath(e.path);window.open("about:blank").location.href=s}},n.goBack=function(e){e.preventDefault(),window.history.back()},n.cleanTrash=function(){n.toggleCleanTrashDialog()},n.toggleCleanTrashDialog=function(){n.setState({isCleanTrashDialogOpen:!n.state.isCleanTrashDialogOpen})},n.refreshTrash=function(){n.setState({isLoading:!0,errorMsg:"",items:[],scanStat:null,more:!1,showFolder:!1}),n.getItems()},n.renderFolder=function(e,t,s){n.setState({showFolder:!0,commitID:e,baseDir:t,folderPath:s,folderItems:[],isLoading:!0}),p.a.listCommitDir(_,e,"".concat(t.substr(0,t.length-1)).concat(s)).then((function(e){n.setState({isLoading:!1,folderItems:e.data.dirent_list})})).catch((function(e){e.response?403==e.response.status?n.setState({isLoading:!1,errorMsg:Object(m.sb)("Permission denied")}):n.setState({isLoading:!1,errorMsg:Object(m.sb)("Error")}):n.setState({isLoading:!1,errorMsg:Object(m.sb)("Please check the network.")})}))},n.clickRoot=function(e){e.preventDefault(),n.refreshTrash()},n.clickFolderPath=function(e,t){t.preventDefault();var s=n.state,r=s.commitID,a=s.baseDir;n.renderFolder(r,a,e)},n.renderFolderPath=function(){var e=n.state.folderPath.split("/");return Object(w.jsxs)(l.a.Fragment,{children:[Object(w.jsx)("a",{href:"#",onClick:n.clickRoot,children:N}),Object(w.jsx)("span",{children:" / "}),e.map((function(t,s){if(s>0&&s!=e.length-1)return Object(w.jsxs)(l.a.Fragment,{children:[Object(w.jsx)("a",{href:"#",onClick:n.clickFolderPath.bind(Object(a.a)(n),e.slice(0,s+1).join("/")),children:e[s]}),Object(w.jsx)("span",{children:" / "})]},s)})),e[e.length-1]]})},n.state={isLoading:!0,errorMsg:"",items:[],scanStat:null,more:!1,isCleanTrashDialogOpen:!1},n}return Object(n.a)(s,[{key:"componentDidMount",value:function(){this.getItems()}},{key:"render",value:function(){var e=this.state,t=e.isCleanTrashDialogOpen,s=e.showFolder;return Object(w.jsxs)(l.a.Fragment,{children:[Object(w.jsxs)("div",{className:"h-100 d-flex flex-column",children:[Object(w.jsxs)("div",{className:"top-header d-flex justify-content-between",children:[Object(w.jsx)("a",{href:m.uc,children:Object(w.jsx)("img",{src:m.Qb+m.Lb,height:m.Kb,width:m.Mb,title:m.vc,alt:"logo"})}),Object(w.jsx)(v.a,{onSearchedClick:this.onSearchedClick})]}),Object(w.jsx)("div",{className:"flex-auto container-fluid pt-4 pb-6 o-auto",children:Object(w.jsx)("div",{className:"row",children:Object(w.jsxs)("div",{className:"col-md-10 offset-md-1",children:[Object(w.jsx)("h2",{children:O.a.generateDialogTitle(Object(m.sb)("{placeholder} Trash"),N)}),Object(w.jsx)("a",{href:"#",className:"go-back",title:Object(m.sb)("Back"),onClick:this.goBack,role:Object(m.sb)("Back"),children:Object(w.jsx)("span",{className:"fas fa-chevron-left"})}),Object(w.jsxs)("div",{className:"d-flex justify-content-between align-items-center op-bar",children:[Object(w.jsxs)("p",{className:"m-0",children:[Object(m.sb)("Current path: "),s?this.renderFolderPath():N]}),"/"==y&&T&&!s&&Object(w.jsx)("button",{className:"btn btn-secondary clean",onClick:this.cleanTrash,children:Object(m.sb)("Clean")})]}),Object(w.jsx)(P,{data:this.state,getMore:this.getMore,renderFolder:this.renderFolder})]})})})]}),t&&Object(w.jsx)(g.a,{children:Object(w.jsx)(C,{repoID:_,refreshTrash:this.refreshTrash,toggleDialog:this.toggleCleanTrashDialog})})]})}}]),s}(l.a.Component),P=function(e){Object(c.a)(s,e);var t=Object(o.a)(s);function s(e){var n;return Object(r.a)(this,s),(n=t.call(this,e)).theadData=[{width:"5%",text:""},{width:"45%",text:Object(m.sb)("Name")},{width:"20%",text:Object(m.sb)("Delete Time")},{width:"15%",text:Object(m.sb)("Size")},{width:"15%",text:""}],n}return Object(n.a)(s,[{key:"render",value:function(){var e=this,t=this.props.data,s=t.isLoading,r=t.errorMsg,n=t.items,a=t.more,c=t.showFolder,o=t.commitID,i=t.baseDir,d=t.folderPath,h=t.folderItems;return Object(w.jsxs)(l.a.Fragment,{children:[Object(w.jsxs)("table",{className:"table-hover",children:[Object(w.jsx)("thead",{children:Object(w.jsx)("tr",{children:this.theadData.map((function(e,t){return Object(w.jsx)("th",{width:e.width,children:e.text},t)}))})}),Object(w.jsx)("tbody",{children:c?h.map((function(t,s){return Object(w.jsx)(B,{item:t,commitID:o,baseDir:i,folderPath:d,renderFolder:e.props.renderFolder},s)})):n.map((function(t,s){return Object(w.jsx)(R,{item:t,renderFolder:e.props.renderFolder},s)}))})]}),s&&Object(w.jsx)(f.a,{}),r&&Object(w.jsx)("p",{className:"error mt-6 text-center",children:r}),a&&!s&&!c&&Object(w.jsx)("button",{className:"btn btn-block more mt-6",onClick:this.props.getMore,children:Object(m.sb)("More")})]})}}]),s}(l.a.Component),R=function(e){Object(c.a)(s,e);var t=Object(o.a)(s);function s(e){var n;return Object(r.a)(this,s),(n=t.call(this,e)).handleMouseOver=function(){n.setState({isIconShown:!0})},n.handleMouseOut=function(){n.setState({isIconShown:!1})},n.restoreItem=function(e){e.preventDefault();var t=n.props.item,s=t.commit_id,r=t.parent_dir+t.obj_name;(t.is_dir?p.a.restoreFolder(_,s,r):p.a.restoreFile(_,s,r)).then((function(e){n.setState({restored:!0}),x.a.success(Object(m.sb)("Successfully restored 1 item."))})).catch((function(e){var t="";t=e.response?e.response.data.error_msg||Object(m.sb)("Error"):Object(m.sb)("Please check the network."),x.a.danger(t)}))},n.renderFolder=function(e){e.preventDefault();var t=n.props.item;n.props.renderFolder(t.commit_id,t.parent_dir,O.a.joinPath("/",t.obj_name))},n.state={restored:!1,isIconShown:!1},n}return Object(n.a)(s,[{key:"render",value:function(){var e=this.props.item,t=this.state,s=t.restored,r=t.isIconShown;return s?null:e.is_dir?Object(w.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[Object(w.jsx)("td",{className:"text-center",children:Object(w.jsx)("img",{src:O.a.getFolderIconUrl(),alt:Object(m.sb)("Directory"),width:"24"})}),Object(w.jsx)("td",{children:Object(w.jsx)("a",{href:"#",onClick:this.renderFolder,children:e.obj_name})}),Object(w.jsx)("td",{title:u()(e.deleted_time).format("LLLL"),children:u()(e.deleted_time).format("YYYY-MM-DD")}),Object(w.jsx)("td",{}),Object(w.jsx)("td",{children:Object(w.jsx)("a",{href:"#",className:r?"":"invisible",onClick:this.restoreItem,role:"button",children:Object(m.sb)("Restore")})})]}):Object(w.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,onFocus:this.handleMouseOver,children:[Object(w.jsx)("td",{className:"text-center",children:Object(w.jsx)("img",{src:O.a.getFileIconUrl(e.obj_name),alt:Object(m.sb)("File"),width:"24"})}),Object(w.jsx)("td",{children:Object(w.jsx)("a",{href:"".concat(m.uc,"repo/").concat(_,"/trash/files/?obj_id=").concat(e.obj_id,"&commit_id=").concat(e.commit_id,"&base=").concat(encodeURIComponent(e.parent_dir),"&p=").concat(encodeURIComponent("/"+e.obj_name)),target:"_blank",children:e.obj_name})}),Object(w.jsx)("td",{title:u()(e.deleted_time).format("LLLL"),children:u()(e.deleted_time).format("YYYY-MM-DD")}),Object(w.jsx)("td",{children:O.a.bytesToSize(e.size)}),Object(w.jsx)("td",{children:Object(w.jsx)("a",{href:"#",className:r?"":"invisible",onClick:this.restoreItem,role:"button",children:Object(m.sb)("Restore")})})]})}}]),s}(l.a.Component),B=function(e){Object(c.a)(s,e);var t=Object(o.a)(s);function s(e){var n;return Object(r.a)(this,s),(n=t.call(this,e)).handleMouseOver=function(){n.setState({isIconShown:!0})},n.handleMouseOut=function(){n.setState({isIconShown:!1})},n.renderFolder=function(e){e.preventDefault();var t=n.props.item,s=n.props,r=s.commitID,a=s.baseDir,c=s.folderPath;n.props.renderFolder(r,a,O.a.joinPath(c,t.name))},n.state={isIconShown:!1},n}return Object(n.a)(s,[{key:"render",value:function(){var e=this.props.item,t=(this.state.isIconShown,this.props),s=t.commitID,r=t.baseDir,n=t.folderPath;return"dir"==e.type?Object(w.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[Object(w.jsx)("td",{className:"text-center",children:Object(w.jsx)("img",{src:O.a.getFolderIconUrl(),alt:Object(m.sb)("Directory"),width:"24"})}),Object(w.jsx)("td",{children:Object(w.jsx)("a",{href:"#",onClick:this.renderFolder,children:e.name})}),Object(w.jsx)("td",{}),Object(w.jsx)("td",{}),Object(w.jsx)("td",{})]}):Object(w.jsxs)("tr",{onMouseOver:this.handleMouseOver,onMouseOut:this.handleMouseOut,children:[Object(w.jsx)("td",{className:"text-center",children:Object(w.jsx)("img",{src:O.a.getFileIconUrl(e.name),alt:Object(m.sb)("File"),width:"24"})}),Object(w.jsx)("td",{children:Object(w.jsx)("a",{href:"".concat(m.uc,"repo/").concat(_,"/trash/files/?obj_id=").concat(e.obj_id,"&commit_id=").concat(s,"&base=").concat(encodeURIComponent(r),"&p=").concat(encodeURIComponent(O.a.joinPath(n,e.name))),target:"_blank",children:e.name})}),Object(w.jsx)("td",{}),Object(w.jsx)("td",{children:O.a.bytesToSize(e.size)}),Object(w.jsx)("td",{})]})}}]),s}(l.a.Component);h.a.render(Object(w.jsx)(L,{}),document.getElementById("wrapper"))}},[[1735,1,0]]]);
//# sourceMappingURL=repoFolderTrash.chunk.js.map